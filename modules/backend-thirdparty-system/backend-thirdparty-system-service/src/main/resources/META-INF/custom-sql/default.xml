<?xml version="1.0" encoding="UTF-8"?>
<custom-sql>
	<sql id="org.opencps.thirdparty.system.service.persistence.ILDoanhNghiepFinder.searchDoanhNghiep">
		<![CDATA[
			SELECT ttnd_doanhnghiep.* 
			FROM ttnd_doanhnghiep 
			WHERE 
				(masothue LIKE ?) OR 
				(sogcn_dkkd LIKE ?) OR 
				(ttnd_doanhnghiep.ten LIKE ?)
		]]>
	</sql>
	
	<sql id="org.opencps.thirdparty.system.service.persistence.ViewGiayPhepVanTaiFinder.searchByGiayPhep">
		<![CDATA[
			SELECT
				* 
			FROM
				(
				SELECT
					@ROW /*'*/
					:= /*'*/
					@ROW + 1 AS id,
					view_giayphepvantai.* 
				FROM
					(
						(
						SELECT
							coquanquanly_id,
							doanhnghiep_id,
							sogiayphep,
							lancapphep,
							ngaycap,
							nguoicap,
							ngayhethan,
							nguoidieuhanh,
							bangcap,
							ngaysinh,
							socmnd,
							nguoiky,
							nguoiky_id,
							ngayky,
							ngay_thuhoi,
							lydo_thuhoi,
							ghichu,
							trangthai,
							'TN' AS typeCode,
							'Trong nước' AS typeName 
						FROM
							phbh_giayphepvantai 
						ORDER BY
							ngayhethan DESC 
						) UNION
						(
						SELECT
							coquanquanly_id AS coquanquanly_id,
							doanhnghiep_id AS doanhnghiep_id,
							sogiayphep AS sogiayphep,
							lancapphep AS lancapphep,
							ngaycap AS ngaycap,
							nguoicap AS nguoicap,
							ngayhethan AS ngayhethan,
							NULL AS nguoidieuhanh,
							NULL AS bangcap,
							NULL AS ngaysinh,
							NULL AS socmnd,
							ten_nguoiky AS nguoiky,
							nguoi_ky_id AS nguoiky_id,
							ngay_ky AS ngayky,
							ngay_thuhoi AS ngay_thuhoi,
							lydo_thuhoi AS lydo_thuhoi,
							ghichu AS ghichu,
							trangthai AS trangthai,
							'QT' AS typeCode,
							'Quốc tế' AS typeName 
						FROM
							nsw_giayphepvantai 
						ORDER BY
							ngayhethan DESC 
						) UNION
						(
						SELECT
							0 AS coquanquanly_id,
						CASE
								ISNULL( doanhnghiepid ) 
								WHEN 1 THEN
								( SELECT id FROM ttnd_doanhnghiep WHERE ttnd_doanhnghiep.ten = il_certificate.applicantName LIMIT 1 ) ELSE doanhnghiepid 
							END AS doanhnghiep_id,
							licenceNo AS sogiayphep,
							1 AS lancapphep,
							validFrom AS ngaycap,
							govAgencyName AS nguoicap,
							validUntil AS ngayhethan,
							NULL AS nguoidieuhanh,
							NULL AS bangcap,
							NULL AS ngaysinh,
							NULL AS socmnd,
							NULL AS nguoiky,
							1 AS nguoiky_id,
							NULL AS ngayky,
							NULL AS ngay_thuhoi,
							NULL AS lydo_thuhoi,
							OtherRemarks AS ghichu,
							1 AS trangthai,
							fileTemplateNo AS typeCode,
							licenceName AS typeName 
						FROM
							il_certificate 
						WHERE
							fileTemplateNo IN ( 'KQ_GPVTDBQT_VL', 'KQ_GPVTDB_VC', 'KQ_CTKTT_VL', 'KQ_CTBS_PTKTT_VL', 'KQ_CTTT_PTKTT_VL', 'KQ_CTNKT_VL', 'CTKTT_VT', 'CTKTT_CLV', 'KQ_CTKTTCD_VC', 'KQ_CTBSPT_KTTCD_VC', 'KQ_CTTTPT_KTTCD_VC', 'KQ_CTNKT_TCD_VC', 'KQ_VBCT_DCTXTCD_VC', 'KQ_GPVTDBQT_GMS' ) 
						ORDER BY
							ngayhethan DESC 
						) 
					) AS view_giayphepvantai,
				( SELECT @ROW /*'*/ := /*'*/ 0 ) AS foo 
				) AS view_giayphepvantai WHERE doanhnghiep_id = ?
		]]>
	</sql>
	
	
	<sql id="org.opencps.thirdparty.system.service.persistence.ViewPhuongTienFinder.searchByPhuongTien">
		<![CDATA[
			SELECT
				* 
			FROM
				(
				SELECT
					@ROW /*'*/
					:= /*'*/
					@ROW + 1 AS id,
					view_phuongtien.* 
				FROM
					(
						(
						SELECT
							bienkiemsoat,
							succhua,
							loaighe_id,
							namsanxuat,
							nuocsanxuat_id,
							tenhieuxe_id,
							mauson_id,
							sokhung,
							somay,
							namhetnienhansudung,
							namcaitao,
							trongtai,
							loaihinhvantai_id,
							la_xegiuongnam,
							sogiuongnam,
							tennguoisohuu,
							doanhnghiep_id,
							tuyenkhaithac_id,
							web_giamsathanhtrinh,
							tendangnhap_gsht,
							matkhau_gsht,
							ghichu,
							trangthai,
							coquanquanly_id,
							congdan_id,
							'TN' AS typeCode,
							'Trong nước' AS typeName 
						FROM
							phbh_phuongtien 
						) UNION
						(
						SELECT
							registrationNumber AS bienkiemsoat,
							0 AS succhua,
							0 AS loaighe_id,
							manufacturedYear AS namsanxuat,
							0 AS nuocsanxuat_id,
							trademarkCode AS tenhieuxe_id,
							0 AS mauson_id,
							chassisNumber AS sokhung,
							engineNumber AS somay,
							0 AS namhetnienhansudung,
							0 AS namcaitao,
							0 AS trongtai,
							0 AS loaihinhvantai_id,
							0 AS la_xegiuongnam,
							0 AS sogiuongnam,
							VehicleOwner AS tennguoisohuu,
						CASE
								ISNULL( doanhnghiepid ) 
								WHEN 1 THEN
								( SELECT id FROM ttnd_doanhnghiep WHERE ttnd_doanhnghiep.ten = il_vehicle.NameOfCompany LIMIT 1 ) ELSE doanhnghiepid 
							END AS doanhnghiep_id,
							0 AS tuyenkhaithac_id,
							0 AS web_giamsathanhtrinh,
							0 AS tendangnhap_gsht,
							0 AS matkhau_gsht,
							CONCAT(
								'Trọng tải/ Số chỗ ngồi: ',
								capacity,
								'\n',
								'Nhãn hiệu: ',
								trademarkName,
								'\n',
								'Màu sơn: ',
								vehicleColor,
								'\n',
								'Kiểu loại: ',
							CASE
									ISNULL( vehicleModelCode ) 
									WHEN 1 THEN
									'---' ELSE vehicleModelCode 
								END,
							CASE
									ISNULL( vehicleModelName ) 
									WHEN 1 THEN
									'---' ELSE vehicleModelName 
								END,
								'\n' 
							) AS ghichu,
							1 AS trangthai,
							0 AS coquanquanly_id,
							0 AS congdan_id,
							'LV' AS typeCode,
							'Liên vận' AS typeName 
						FROM
							il_vehicle 
						) 
					) AS view_phuongtien,
				( SELECT @ROW /*'*/ := /*'*/ 0 ) AS foo 
				) AS view_phuongtien WHERE bienkiemsoat = ?
		]]>
	</sql>
	
	
</custom-sql>